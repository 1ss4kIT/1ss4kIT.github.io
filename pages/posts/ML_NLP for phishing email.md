---
categories: 恶意URL检测
date: 2021-08-19 10:41:37
layout: post
tags: null
title: 恶意URL检测(十)应用ML和NLP的方法去检测钓鱼邮件
---

## 1.背景



### 1.1刊物/会议级别

​	2021年7月发表于Computers & Security ；刊物检索级别：SCI；影响因子2.849；

中科院分区：工程技术 3区 计算机：信息系统。属于CCF- B类文章。



### 1.2作者团队



​	有两位作者，都来自沙特国王大学。



### 1.3文章创新点

1、 使用GCN去检测钓鱼邮件，并且检测对象是邮件的文本主体。

2、 本文方法只需要用到邮件的body text即可，而现有的方法大多需要用到邮件中的URL或其他信息。

3、 虽然本文提出的方法是部署在邮件服务器端去进行检测的，但是方法是通用的，也可在短信、推特等媒介进行钓鱼检测。



## 2.相关工作进展



​	钓鱼攻击技术发展迅速，并且最常使用的方法是邮件钓鱼，所以需要有一定的手段对其进行防御。现有的技术可以大致分为两类：黑名单和机器学习的方法，以下重点关注机器学习的方法。为了提高分类性能，主要有两大类的改进方法：(1)使用不同的分类算法 (2)改进特征选择。

### 2.1特征选择

* [Aassal,2020] 提出了三类主要特征：header特征，包括时间戳、接收服务器(存疑，不理解为什么要是接收服务器)、内容格式等；body特征：文本和URL；第三大类特征是attachment。

* [Toolan, 2010] 使用了40个特征，并且将他们分为了4大类：基于body；基于URL；基于subject；基于script的特征。结果证明基于body的特征效果最好。

### 2.2分类算法

* [Halgas, 2020] 提出，对于无结构的数据，如邮件的内容，深度学习算法最合适。

* [Prasad, 2019] 证明在文本分类，深度学习的效果比NLP好。

* [Lai ,2015] 使用了RCNN模型，使用最邻近结构去得到文本的上下文信息，同时使用CNN去构建一个文本的表示。多个模型比较后发现RCNN模型效果最好。

* [Yao, 2019] 提出基于图神经网络的文本分类算法，即将整个语料库表示为一个图，并且使用图神经网络去学习词和文本嵌入。

* [Fang, 2019] 提出了THEMIS分类模型，操作对象是邮件的头部和主体，随后使用Word2Vec去表示整个文本，模型使用RCNN深度学习模型。

* [Almomani, 2013] 提出了动态发展神经fuzzy框架(本文介绍不多，可看原文了解)，它调整了进化连接系统。

  

 ## 3.本文方法

​	本文使用NLP去处理电子邮件的body特征，并且使用GCN作为深度学习算法去检测钓鱼邮件。最开始输入的邮件包含有很多不相关的信息，需要进行图的构建。整体的操作流程如下图所示：

 ![1-frame](/ML_NLP for phishing email/1-frame.png)

### 3.1数据预处理

​	首先需要对数据进行预处理，清除一些不相关的字符、转换格式，以方便后续操作。预处理的操作如下：

(1) 提取邮件中body文本的内容；

(2) 消除文本parsing所产生的空格；

(3) 将所有字符转为小写，移除非字母的字符。

在具体实现时，是以下3个步骤实现的：

(1) 邮件清理：清除掉邮件不相关的信息以及非英文的字符。伪代码语句如下图：

 ![2-process](/ML_NLP for phishing email/2-process.png)

(2) Tokenization：基于空格，将邮件划分为词。具体实现的时候使用到了split()函数。

(3) 移除一些停词以及出现频率较低的词：使用NLTK的停词列表，并且出现次数<7次的词会被删除。伪代码如下：

 ![3-process2](/ML_NLP for phishing email/3-process2.png)



### 3.2图构建

​	从语料库中构建图，将词和邮件作为节点，连接两个词的边取决于两个节点共同出现的信息，而连接词和邮件的边是使用词频率和词的邮件频率构建的。这就将文本分类问题转化为了节点分类问题。

​	无向图G = (V, E)，用到了邻接矩阵A来表示无向图，矩阵中的值是每个关系的权重。边的值为两个词节点的同时出现频率，其计算方式如下图：

 ![4-calculate](/ML_NLP for phishing email/4-calculate.png)

其中P(I,J) 表示I和J同时出现的概率；如果是词和邮件，就计算TF- IDF的值。

### 3.3GCN分类器

​	GCN算法是半监督的学习算法，常用于文本分类，将文本分类的问题转化为节点分类问题。它的工作原理是：先通过整个邮件的语料库创建一个语料图，这样就将邮件表示为了节点图，节点中的每个图都包含着所有邻近节点的信息。随后将图输入到卷积神经网络中。

​	在将邻近节点的信息进行传输之前，会进行scaled或归一化。Scaled方式如下：

 ![5-scales](/ML_NLP for phishing email/5-scales.png)

​	在GCN中，如果使用一个卷积神经网络层，那么节点只能从它的最邻近节点得到信息，因此需要更多的卷积层，并且需要的节点越多，需要的卷积层也就越多。[Kipf, 2017] 指出大多数都使用两到三层卷积层。

​	第一层计算如下：

 ![6-firstcalcu](/ML_NLP for phishing email/6-firstcalcu.png)

其中A～是scaled后的adjacency矩；X是A的identity矩；W是权重矩，可以用梯度下降去计算；p是激活函数。

​	其他层的计算如下：

 ![7-otherlayer](/ML_NLP for phishing email/7-otherlayer.png)

​	得到的邮件的特征矩阵输入到神经网络中，随后神经网络的隐藏层灰进行学习，随后输出层会进行判断，判定一个邮件是否是钓鱼文件。

## 4.实验结果及评估

### 4.1数据集

​	使用[Radev, 2008] 提出的数据集，包含3685个钓鱼邮件，4894个合法的邮件。

### 4.2GCN参数设置

参考[Kipf, 2017] 年的文章，参数设定如下：

学习率：0.1；

Solver：Adam；

Shuffle：True；

Early stoping：10个epochs之后；

GCN层数：2层；

损失函数：交叉熵；



### 4.3结果评估

​	使用的评价指标有：FP、TN、FN、TP、准确率、感知度、回召率和FPR。在评价分类器的有效性时，两种常用的方法是holdout和k -fold交叉验证。本文这两种方法都使用了，在holdout划分时，训练集和测试集的占比分别为70%和30%。同时，还使用了3-folds交叉验证的方法，把数据集分为了三组，分类器训练了三次。3-folds交叉验证的方法结果如下：

 ![8-3foldvalidation](/ML_NLP for phishing email/8-3foldvalidation.png)

混淆矩阵的结果如下：

![9-confusionmatrix](/ML_NLP for phishing email/9-confusionmatrix.png)

其他指标结果如下： ![10-othervalues](/ML_NLP for phishing email/10-othervalues.png)

同时，又将现有的结果与其他方法进行比较，结果如下图所示： ![11-othervalues](/ML_NLP for phishing email/11-othervalues.png)

​	虽然有一些方法看似性能更好，但是与他们相比，本文方法所使用到的数据更少，且没有手动特征选取阶段。

​	有的方法用到了图像，但是耗时更久。

​	时间复杂度：本文方法的时间复杂度为O(LED+LND2)，空间复杂度为O(E)，其中L是层数，N是总节点数，D是特征纬度，E是图的边数。平均训练6005个邮件的时间为3.89分。

 

### 4.4将来研究方向

(1) 研究非英语语言的邮件

(2) 将此方法应用于邮件分类

(3) 在真实环境中检测0day 钓鱼邮件 



## 5.个人总结及研究启示

1、本文概述：

操作对象：电子邮件主体

深度学习算法：图卷积神经网络 (GCN) / NLP

2、文章局限性

只能检测英文语言的邮件；

所使用的数据集有点老，是2008年的；

没有创新性较大的内容；